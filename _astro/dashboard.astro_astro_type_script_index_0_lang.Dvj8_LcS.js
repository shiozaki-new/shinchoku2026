const x="modulepreload",C=function(e){return"/"+e},k={},v=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let o=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),d=a?.nonce||a?.getAttribute("nonce");s=o(n.map(l=>{if(l=C(l),l in k)return;k[l]=!0;const c=l.endsWith(".css"),m=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${m}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":x,c||(u.as="script"),u.crossOrigin="",u.href=l,d&&u.setAttribute("nonce",d),document.head.appendChild(u),c)return new Promise((L,T)=>{u.addEventListener("load",L),u.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};function D(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches;E(e||(t?"dark":"light")),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",i=>{localStorage.getItem("theme")||E(i.matches?"dark":"light")})}function E(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),M(e)}function B(){const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";E(t)}function M(e){const t=document.getElementById("btn-theme-toggle");t&&(t.textContent=e==="dark"?"â˜€ï¸":"ğŸŒ™",t.setAttribute("aria-label",e==="dark"?"ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿":"ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿"))}function y(e){const t=document.getElementById(e);if(!t){console.error(`Dialog with id "${e}" not found`);return}t.showModal(),$(t);const n=t.querySelector("input, select, textarea, button");n&&setTimeout(()=>n.focus(),100)}function $(e){const t='button, input, select, textarea, a[href], [tabindex]:not([tabindex="-1"])';e.removeEventListener("keydown",n);function n(i){if(i.key!=="Tab")return;const s=Array.from(e.querySelectorAll(t)),r=s[0],o=s[s.length-1];i.shiftKey?document.activeElement===r&&(i.preventDefault(),o.focus()):document.activeElement===o&&(i.preventDefault(),r.focus())}e.addEventListener("keydown",n)}function q(){document.querySelectorAll("[data-close]").forEach(e=>{e.addEventListener("click",t=>{const n=t.target.closest("dialog");n&&n.close()})}),document.querySelectorAll("dialog").forEach(e=>{e.addEventListener("click",t=>{const n=e.getBoundingClientRect();n.top<=t.clientY&&t.clientY<=n.top+n.height&&n.left<=t.clientX&&t.clientX<=n.left+n.width||e.close()})})}const A=[{id:"newcom07",title:"newcom07.jp",category:"å…¬é–‹ã‚µã‚¤ãƒˆ",children:[{id:"newcom-sfa",title:"SFA",progress:80,status:"é€²è¡Œä¸­",deadline:"2026/02/14"},{id:"newcom-mes",title:"MES",progress:80,status:"é€²è¡Œä¸­",deadline:"2026/02/14"},{id:"newcom-qms",title:"QMS",progress:80,status:"é€²è¡Œä¸­",deadline:"2026/02/14"}]},{id:"domain-update",title:"ãƒ‰ãƒ¡ã‚¤ãƒ³æ›´æ–°ä½œæ¥­",category:"ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",children:[{id:"domain-newcom",title:"newcom07.jp",progress:100,status:"å®Œäº†",deadline:"2026/01/15"}]},{id:"ssl-update",title:"SSLæ›´æ–°ä½œæ¥­",category:"ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†",children:[{id:"ssl-newcom",title:"newcom07.jp",progress:100,status:"å®Œäº†",deadline:"2026/01/15"},{id:"ssl-dbsheet",title:"dbsheetclient.jp",progress:100,status:"å®Œäº†",deadline:"2026/01/15"}]}],Q={apiKey:"AIzaSyC1cVgoBleKcvXU3Z1G0FNY8JlL72pNP-c",authDomain:"kikakugyoumu-907d6.firebaseapp.com",projectId:"kikakugyoumu-907d6",storageBucket:"kikakugyoumu-907d6.firebasestorage.app",messagingSenderId:"259870871782",appId:"1:259870871782:web:6cad7ff451d8cb5fdd6b27"};let g=[...A];function Z(e){g.splice(0,g.length,...e),S()}function S(){F(),P(),_()}function F(){const e=g.flatMap(o=>o.children),t=e.filter(o=>o.status==="é€²è¡Œä¸­").length,n=e.filter(o=>o.status==="å®Œäº†").length,i=e.filter(o=>o.status==="ä¿ç•™").length;document.getElementById("kpi-inprogress").querySelector(".kpi-value").textContent=t,document.getElementById("kpi-completed").querySelector(".kpi-value").textContent=n,document.getElementById("kpi-hold").querySelector(".kpi-value").textContent=i;const s=e.filter(o=>o.deadline&&o.status!=="å®Œäº†").map(o=>({...o,days:p(o.deadline)})).sort((o,a)=>o.days-a.days)[0],r=document.getElementById("kpi-deadline");if(s){r.querySelector(".kpi-value").textContent=s.deadline;const o=r.querySelector(".kpi-meta");if(o){const a=s.days===0?"ä»Šæ—¥":s.days===1?"æ˜æ—¥":s.days<0?`${Math.abs(s.days)}æ—¥é…å»¶`:`${s.days}æ—¥å¾Œ`;o.textContent=a,o.style.color=R(s.days)}}else{r.querySelector(".kpi-value").textContent="--";const o=r.querySelector(".kpi-meta");o&&(o.textContent="")}}function P(){const t=I(g).filter(s=>s.status!=="å®Œäº†").map(s=>({...s,risk:N(s),days:p(s.deadline)})).filter(s=>s.risk!=="none").sort((s,r)=>{const o={high:0,medium:1,low:2},a=o[s.risk]-o[r.risk];return a!==0?a:s.days-r.days}).slice(0,5),n=document.getElementById("priority-list"),i=document.getElementById("priority-task-template");if(!(!n||!i)){if(n.innerHTML="",t.length===0){n.innerHTML='<p style="text-align:center;color:var(--text-secondary)">å„ªå…ˆã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“</p>';return}t.forEach(s=>{const r=i.content.cloneNode(!0),o=r.querySelector(".priority-task");o.setAttribute("data-risk",s.risk),o.querySelector(".priority-title").textContent=`${s.parentTitle} - ${s.title}`;const a=s.deadline||"--",d=s.deadline?s.days===0?"ä»Šæ—¥":s.days===1?"æ˜æ—¥":s.days<0?`${Math.abs(s.days)}æ—¥é…å»¶`:`${s.days}æ—¥å¾Œ`:"";o.querySelector(".priority-deadline").textContent=`${a} ${d}`,o.querySelector(".progress-ring").style.setProperty("--progress",s.progress);const c=o.querySelector(".progress-percent");c.textContent=`${s.progress}%`,n.appendChild(r)})}}function _(){const e=document.getElementById("last-update");if(e){const t=new Date,n=`${t.getFullYear()}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`;e.textContent=n}}function I(e){return e.flatMap(t=>t.children.map(n=>({...n,parentId:t.id,parentTitle:t.title,category:t.category})))}function p(e){if(!e)return 1/0;const t=new Date;t.setHours(0,0,0,0);const n=e.split("/"),i=new Date(n[0],n[1]-1,n[2]);i.setHours(0,0,0,0);const s=i-t;return Math.ceil(s/(1e3*60*60*24))}function N(e){if(!e.deadline||e.status==="å®Œäº†")return"none";const t=p(e.deadline),n=e.progress||0;return t<=5&&n<80||t<=10&&n<50||e.status==="ä¿ç•™"&&t<=14?"high":t<=15&&n<30?"medium":t<=30||n<100?"low":"none"}function R(e){return e<0||e<=5?"var(--risk-high)":e<=14?"var(--risk-medium)":"var(--text-secondary)"}function H(){const e=document.getElementById("filter-form");if(!e)return;const t=new URLSearchParams(window.location.search);t.has("status")&&(e.status.value=t.get("status")),t.has("deadline")&&(e.deadline.value=t.get("deadline")),t.has("sort")&&(e.sort.value=t.get("sort")),t.has("search")&&(e.search.value=t.get("search")),e.addEventListener("change",b),e.search.addEventListener("input",z(b,300)),b()}function b(){const e=document.getElementById("filter-form");if(!e)return;const t=e.status?.value||"å…¨ã¦",n=e.deadline?.value||"å…¨ã¦",i=e.sort?.value||"deadline-asc",s=e.search?.value.toLowerCase()||"";j({status:t,deadline:n,sort:i,search:s});let r=I(g);if(t!=="å…¨ã¦"&&(r=r.filter(o=>o.status===t)),n!=="å…¨ã¦")if(n==="æœŸé™ãªã—")r=r.filter(o=>!o.deadline);else{const o=parseInt(n);r=r.filter(a=>{if(!a.deadline)return!1;const d=p(a.deadline);return d<=o&&d>=0})}s&&(r=r.filter(o=>o.title.toLowerCase().includes(s)||o.parentTitle.toLowerCase().includes(s)||o.category.toLowerCase().includes(s))),r.sort((o,a)=>{if(i.startsWith("deadline")){const d=o.deadline?new Date(o.deadline):new Date("9999/12/31"),l=a.deadline?new Date(a.deadline):new Date("9999/12/31");return i==="deadline-asc"?d-l:l-d}else if(i.startsWith("progress")){const d=o.progress||0,l=a.progress||0;return i==="progress-asc"?d-l:l-d}return 0}),U(r)}function U(e){const t=document.getElementById("task-tbody"),n=document.getElementById("task-row-template");if(!(!t||!n)){if(t.innerHTML="",e.length===0){t.innerHTML='<tr><td colspan="5" style="text-align:center;padding:32px;color:var(--text-secondary)">ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</td></tr>';return}e.forEach(i=>{const s=n.content.cloneNode(!0),r=s.querySelector(".task-row");r.setAttribute("data-task-id",i.id),r.setAttribute("data-parent-id",i.parentId),r.querySelector(".task-title").textContent=`${i.parentTitle} - ${i.title}`;const o=r.querySelector(".progress-fill"),a=r.querySelector(".progress-text");o.style.width=`${i.progress||0}%`,a.textContent=`${i.progress||0}%`;const d=r.querySelector(".status-badge");d.textContent=i.status,d.className=`status-badge status-${i.status}`;const l=r.querySelector(".task-deadline");if(i.deadline){const c=p(i.deadline),m=c===0?"ä»Šæ—¥":c===1?"æ˜æ—¥":c<0?`${Math.abs(c)}æ—¥é…å»¶`:`${c}æ—¥å¾Œ`;l.innerHTML=`${i.deadline}<br><small style="color:var(--text-secondary)">${m}</small>`}else l.textContent="--";t.appendChild(s)})}}function j(e){const t=new URLSearchParams;e.status&&e.status!=="å…¨ã¦"&&t.set("status",e.status),e.deadline&&e.deadline!=="å…¨ã¦"&&t.set("deadline",e.deadline),e.sort&&e.sort!=="deadline-asc"&&t.set("sort",e.sort),e.search&&t.set("search",e.search);const n=t.toString()?`?${t}`:window.location.pathname;history.replaceState(null,"",n)}function z(e,t){let n;return function(...s){const r=()=>{clearTimeout(n),e(...s)};clearTimeout(n),n=setTimeout(r,t)}}let w=!1,f=!1;document.addEventListener("DOMContentLoaded",()=>{console.log("Dashboard initializing..."),D(),S(),H(),q(),O(),console.log("Dashboard initialized")});function O(){const e=document.getElementById("btn-theme-toggle");e&&e.addEventListener("click",B);const t=document.getElementById("btn-hoshitori");t&&t.addEventListener("click",()=>y("modal-hoshitori"));const n=document.getElementById("btn-login");n&&n.addEventListener("click",()=>y("modal-login"));const i=document.getElementById("btn-logout");i&&i.addEventListener("click",Y);const s=document.getElementById("btn-edit-toggle");s&&s.addEventListener("click",V);const r=document.getElementById("form-login");r&&r.addEventListener("submit",K);const o=document.getElementById("btn-new-task");o&&o.addEventListener("click",W);const a=document.getElementById("task-tbody");a&&a.addEventListener("click",X)}async function K(e){e.preventDefault();const t=new FormData(e.target),n=t.get("email"),i=t.get("password");if(!n||!i){alert("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");return}const r=await(await h()).login(n,i);if(r.success){const o=document.getElementById("modal-login");o&&o.close(),e.target.reset()}else alert(`ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ${r.error||"ä¸æ˜ãªã‚¨ãƒ©ãƒ¼"}`)}async function Y(){await(await h()).logout(),f=!1,document.body.classList.remove("edit-mode");const t=document.getElementById("btn-edit-toggle");t&&(t.textContent="ç·¨é›†ãƒ¢ãƒ¼ãƒ‰")}async function V(){f=!f,document.body.classList.toggle("edit-mode",f);const e=document.getElementById("btn-edit-toggle");e&&(e.textContent=f?"ç·¨é›†ãƒ¢ãƒ¼ãƒ‰è§£é™¤":"ç·¨é›†ãƒ¢ãƒ¼ãƒ‰"),f&&!w&&await h()}async function W(){y("modal-task-edit")}async function X(e){const t=e.target.closest(".btn-edit"),n=e.target.closest(".btn-delete");if(t){const i=t.closest(".task-row"),s=i?.getAttribute("data-task-id"),r=i?.getAttribute("data-parent-id");s&&r&&await G(r,s)}else if(n){const s=n.closest(".task-row")?.getAttribute("data-parent-id");s&&await J(s)}}async function G(e,t){console.log("Edit task:",e,t),y("modal-task-edit")}async function J(e){await(await h()).deleteTask(e)}async function h(){if(w)return await v(()=>import("./firebase-crud.D88TELG_.js"),[]);console.log("Lazy loading Firebase module...");const e=await v(()=>import("./firebase-crud.D88TELG_.js"),[]);return await e.initFirebase(),w=!0,e}export{Q as F,A as I,b as a,Z as s};
